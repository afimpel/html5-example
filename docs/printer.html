<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript PRINTER API</title>
  </head>

  <body style="font-size: 24px; padding: 1rem">
    <h1 style="text-align: center; border: 1px solid green; padding: 1rem">
      JavaScript PRINTER API
    </h1>
    <pre
      style="border: 1px solid green; padding: 1rem; white-space: pre-wrap"
      id="alerts"
    ></pre>
    <textarea id="printContent"></textarea>
    <input type="submit" onclick="connectAndPrint(this)" value="Print" />

    <p>Type text into box and click on submit button.</p>
    <script>
      function connectAndPrint(parms) {
        console.log("parms :>> ", parms);
        // Selecciona la impresora USB
        navigator.usb
          .requestDevice({ filters: [{ vendorId: 1008, productId: 22039 }] })
          .then((device) => {
            console.log("device :>> ", device);
            return device.open().then((handle) => {
              console.log("handle :>> ", handle);
              return handle.selectConfiguration(1).then(() => {
                console.log("Configuración seleccionada");
                return handle
                  .claimInterface(0)
                  .then(() => {
                    console.log("Interfaz reclamada");
                    const text = "Hola, esto es una prueba de impresión";
                    const encoder = new TextEncoder();
                    const data = encoder.encode(text); // Codifica el texto en bytes
                    return handle.transferOut(1, data); // Envía los datos al dispositivo
                  })
                  .then(() => {
                    console.log("Datos enviados al dispositivo");
                  }); // Reclama la interfaz
              }); // Selecciona la configuración
            });
            // Abre la conexión al dispositivo
          })
          .catch((error) => {
            console.error(`Error: ${error}`);
          });
      }
    </script>
  </body>
</html>
